#Cluster 集群模式



## 集群的数据分片
Redis集群没有使用一致性hash，而是引入了哈希槽【hash slot】的概念。

Redis 集群有16384 个哈希槽，每个 key 通过 CRC16 校验后对 16384 取模来决定放置哪个槽。集群的每个节点负责一部分hash槽，举个例子，比如当前集群有3个节点，那么：

> 节点 A 包含 0 到 5460 号哈希槽
节点 B 包含 5461 到 10922 号哈希槽
节点 C 包含 10923 到 16383 号哈希槽



## 为什么是16384个槽？
1. 减少心跳包的大小
> 如果槽位为65536，发送心跳信息的消息头达8k，发送的心跳包过于庞大。如上所述，在消息头中，最占空间的是**myslots[CLUSTER_SLOTS/8]**。
当槽位为65536时，这块的大小是: **65536÷8÷1024=8kb**
因为每秒钟，redis节点需要发送一定数量的ping消息作为心跳包，如果槽位为65536，这个ping消息的消息头太大了，浪费带宽。

2. redis的集群主节点数量基本不可能超过1000个，16384够用。
> 如上所述，集群节点越多，心跳包的消息体内携带的数据越多。如果节点过1000个，也会导致网络拥堵。
因此redis作者，不建议redis cluster节点数量超过1000个，16384个槽位够用了。没有必要拓展到65536个。